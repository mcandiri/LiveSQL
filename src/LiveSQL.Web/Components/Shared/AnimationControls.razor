@namespace LiveSQL.Web.Components.Shared

<div class="animation-controls">
    <button class="anim-btn" @onclick="OnStepBackward" title="Step Back">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path d="M8.445 14.832A1 1 0 0010 14v-2.798l5.445 3.63A1 1 0 0017 14V6a1 1 0 00-1.555-.832L10 8.798V6a1 1 0 00-1.555-.832l-6 4a1 1 0 000 1.664l6 4z"/>
        </svg>
    </button>

    @if (IsPlaying)
    {
        <button class="anim-btn anim-btn-primary" @onclick="OnPause" title="Pause">
            <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
            </svg>
        </button>
    }
    else
    {
        <button class="anim-btn anim-btn-primary" @onclick="OnPlay" title="Play">
            <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
            </svg>
        </button>
    }

    <button class="anim-btn" @onclick="OnStepForward" title="Step Forward">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path d="M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832L10 11.202V14a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4A1 1 0 0010 6v2.798L4.555 5.168z"/>
        </svg>
    </button>

    <div class="anim-separator"></div>

    <button class="anim-btn" @onclick="OnShowAll" title="Show All">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
        </svg>
    </button>

    <div class="anim-separator"></div>

    <div class="speed-control">
        <span class="speed-label">@Speed.ToString("F1")x</span>
        <input type="range" min="0.5" max="3" step="0.5" value="@Speed"
               @oninput="OnSpeedInput" class="speed-slider" />
    </div>
</div>

@code {
    [Parameter] public EventCallback OnPlay { get; set; }
    [Parameter] public EventCallback OnPause { get; set; }
    [Parameter] public EventCallback OnStepForward { get; set; }
    [Parameter] public EventCallback OnStepBackward { get; set; }
    [Parameter] public EventCallback OnShowAll { get; set; }
    [Parameter] public double Speed { get; set; } = 1.0;
    [Parameter] public EventCallback<double> SpeedChanged { get; set; }
    [Parameter] public bool IsPlaying { get; set; }

    private async Task OnSpeedInput(ChangeEventArgs e)
    {
        if (double.TryParse(e.Value?.ToString(), System.Globalization.NumberStyles.Float, System.Globalization.CultureInfo.InvariantCulture, out var speed))
        {
            await SpeedChanged.InvokeAsync(speed);
        }
    }
}
